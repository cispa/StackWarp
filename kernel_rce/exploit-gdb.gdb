gef config context.layout "legend source regs stack code args memory threads trace extra"
gef config context.nb_lines_stack 20
lx-symbols
# TODO: make this work
set remote interrupt-sequence BREAK-g

tb ksys_sync
c
printf "==> Hit ksys_sync, setting up breakpoint on __x86_return_thunk in core_sys_select\n"

# jmp    <__x86_return_thunk>
# objdump -d vmlinux > out
# grep -A 500 '<core_sys_select>:' out | grep '<__x86_return_thunk>'
tb *0xffffffff812b7073
#tb fs/select.c:722

c

printf "==> Hit __x86_return_thunk in core_sys_select, patching rsp\n"
# finding offset:
# - comment out both lines
# - x/100gx $sp-400
# - p $rsp-0xffffc9000020fd78 (address of marker value, comment in in inject.c)
set $rsp = $rsp - 0x138
c

#lx-dmesg
